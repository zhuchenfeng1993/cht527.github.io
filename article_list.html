<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="author" content="caohaitao">
	<meta name="keywords" content="自我对话,回忆,记录,web前端技术">
	<meta name="description" content="记录昨日的难忘,把握今日的时光,拥抱明日的希望,脚踏实地,不忘初心的走下去">
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	<link rel="shortcut icon" href="./img/favicon.ico" /> 
	<title>十点读书</title>
	<link rel="stylesheet" href="./css/b_t.css">
	<link rel="stylesheet" href="./css/jPages.css">
	<link rel="stylesheet" href="./css/animate.css">
	<link rel="stylesheet" href="./css/sweetalert.css">
	<link rel="stylesheet" type="text/css" href="./css/webFE_header.css">
	<link rel="stylesheet" type="text/css" href="./css/article_list.css" >
</head>
<body oncontextmenu="return false" onselectstart="return false">

<header class="js_header mod-header">
    <div class="mod-header__wrap">
        <div class="js_menu mod-header__nav">
            <ul id="menu-nav" class="menu">
            <li id="menu-item-19" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-19"><a class="nav" href="./index.ds">首页</a></li>
			<li id="menu-item-4814" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-4814"><a class="nav" id="HTML" href="javascript:void(0);" onclick="javascript:window.open('./panda.html')" >一字一元</a></li>
			<li id="menu-item-9" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9"><a id="shidian" class="nav" href="javascript:void(0);">十点读书</a></li>
			<li id="menu-item-12" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12"><a id="webFE" class="nav"  href="javascript:void(0);" onclick="javascript:window.open('/webFE/webFE.html')">前端开发</a></li>
			<li id="menu-item-2813" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2813"><a id="li_diary"  class="nav" href="javascript:void(0);" >心之契约</a></li>
			<li id="menu-item-10" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10"><a class="nav" id="photo" href="javascript:void(0);" onclick="javascript:window.open('/photo_show/photo_show.html')">朝花夕拾</a></li>
			</ul>   
		</div>
    </div>
</header>
<div id="wrapper">
<hr class="divider" width="90%">

<div id="article_items_contianer">
<!---列表-->

<!--列表end-->
</div>

<!--底部页码-->
	<nav aria-label="Page navigation" class="pagination">
	  <ul class="pagination" id="pagination_ul">
	    
	  </ul>
	</nav>
<!--底部页码 end-->
<hr class="divider" style="width:90%">
<footer>
<p>Copyright &copy; 2017&nbsp;<a href="http://www.caohaitao.cc">caohaitao.cc</a>&nbsp;&nbsp;. All Rights Reserved</p>
<p>
<a class="website-record" href="http://www.miibeian.gov.cn" target="_blank">京ICP备&nbsp;16068799号</a>
<a href="https://pages.github.com/" target="_blank" class="github-pages"></a>
</p>
</footer>

</div>

<script type="text/javascript" src="./js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/js/sweetalert.min.js"></script>
<script type="text/javascript" src="./js/nav.js"></script>
<script>

//初始化---list 
var pageSize=5,curPage=1,total=0,pageCount=0;
var articleList=[],curList=[];

function mapArticleList(dataList){
	$.map(dataList,function(value,index,array){
			var itemTemplate=
			'<section class="list">'+ 
				'<h3>'+value.title+'</h3>'+
				'<p style="margin: 10px auto;">原文出自:'+value.author+'</p>'+
				'<div class="container">'+
			   				'<div class="row" id="change_rowwidth">'+
			      				'<div class="col-md-6">'+
									'<div style="margin-top:10px;font-size:15px;line-height:25px;text-overflow:ellipsis">'+value.description+'</div>'+
									'<div style="margin-top:5px">'+
										'<p>'+
											'<a class="more" href="javascript:">阅读全文&nbsp;>>></a>'+
										'</p>'+
									'</div>'+
				  				'</div>'+
				  				'<div class="col-md-5">'+
				  					'<img class="article_img" src="./img/article_img/'+value.id+'.png" />'+
				  				'</div>'+
							'</div>'+
				'</div>'+	
				'<hr class="divider">'+
			'</section>';

			$("#article_items_contianer").append(itemTemplate)
		})
}

//-------分页展现UI------
function showPages(page,total){
	var str='<li data-page='+page+'><a href="javascript:">'+page+'</a></li>';
	for (var i = 1; i <=3; i++) {
		if (page-i>1) {
			str='<li><a href="javascript:">'+(page-i)+'</a></li>'+str;
		}
		if (page+i<total) {
			str=str+'<li><a href="javascript:">'+(page+i)+'</a></li>';
		}
	}
	if (page==1) {
		str='<li>'+
		'<a href="javascript:" aria-label="previous" style="cursor:default;color:#aaa;">'+
			'<span aria-hidden="true" class="previous">&laquo;上一页</span>'+
		'</a>'+
		'</li>'+str;
	}
	if (page==total) {
		str=str+
		'<li>'+
			'<a href="javascript:" aria-label="next" style="cursor:default;color:#aaa;">'+
			    '<span aria-hidden="true" class="next">下一页&raquo;</span>'+
			'</a>'+
		'</li>';
	}
	if (page-4>1) {
		str='<li><a href="javascript:">...</a></li>'+str;
	}
	if (page>1) {
		str='<li>'+
		'<a href="javascript:" aria-label="previous">'+
			'<span aria-hidden="true" class="previous">&laquo;上一页</span>'+
		'</a>'+
		'</li>'+'<li><a href="javascript:">'+1+'</a></li>'+str;
	}
	if (page+4<total) {
		str=str+'<li><a href="javascript:">...</a></li>';
	}
	if (page<total) {
		str=str+'<li><a href="javascript:">'+total+'</a></li>'+
		'<li>'+
			'<a href="javascript:" aria-label="next">'+
			    '<span aria-hidden="true" class="next">下一页&raquo;</span>'+
			'</a>'+
		'</li>';
	}

	return str;
	
};
//----点击分页监听----
$('#pagination_ul').on('click','a',function(){
	var thisPage=parseInt($(this).text());
	if (thisPage<pageCount+1) { // 点击具体页码
		curPage=thisPage;
		doPagination(thisPage,pageCount);
	}else{ //--上一页,下一页分页
		if ($(this).children().eq(0).attr('class')=='previous') {
			if (curPage==1) {
				return;
			}else{
				thisPage=curPage-1;
				doPagination(thisPage,pageCount);
			}
		}else{
			if (curPage==pageCount) {
				return;
			}else{
				thisPage=curPage+1;
				doPagination(thisPage,pageCount);
			}
		}
	}

	
});
//---分页操作---
function doPagination(thisPage,pageCount){
	var thisPagination=showPages(thisPage,pageCount);
	$('#pagination_ul').children().remove();
	$('#pagination_ul').append(thisPagination);
	$('li[data-page='+thisPage+']').addClass('active');
	var start=(thisPage-1)*5,end=thisPage*5;
	var articleData=articleList.slice(start,end);
	curList=articleData;//当前页面的5条数据
	$("#article_items_contianer").children().remove();
	mapArticleList(articleData);
	$("html, body").animate({scrollTop:0},400);
}
//---初始化分页---

	(function getArticleListData(){
		$.ajax({
			method: "GET",
			url: "./data_source/article/articleList.json",
			dataType:"json"
		}).done(function(data) {
			articleList=data.articleList.reverse(); //逆序输出
			total=articleList.length;
			pageCount=Math.ceil(total/pageSize);
			var articleListCopy=articleList;
			var init_articleData=articleListCopy.slice(0,5);
			curList=init_articleData;//当前页面的5条数据
			//console.log(articleList.length);
			mapArticleList(init_articleData);	
			var pagination=showPages(curPage,pageCount);
			$('#pagination_ul').append(pagination);
			$('li[data-page='+curPage+']').addClass('active');	
		}).fail(function(){
		    swal('请求接口失败','error','error')
		});
	})();
	
(function(){
	var $backToTopEle=$('<img class="backToTop" src="/img/backtop.png" />').appendTo($("body")).click(function(){
		$("html, body").animate({scrollTop:0},400);
	}),
	$backToTopFun=function(){
		var st=$(document).scrollTop(),
		winh=$(window).height();
		(st>0)?$backToTopEle.show():$backToTopEle.hide();
		if(!window.XMLHttpRequest){
			$backToTopEle.css("top",st+winh-166);
		}
	};
	$(window).on("scroll",$backToTopFun);
	$(function(){$backToTopFun();});
})();


navObj.addHandler(document.getElementById("li_diary"), "click", show_prompt);

//----阅读原文-事件绑定--
$('#article_items_contianer').on('click','.more',function(){
	var thisId=$(this).attr('id');
	$.map(curList,function(value,index,array){
		if (value.id==thisId) {
			window.location.href='article_show.html?target='+Date.parse(new Date())+'_'+value.id+'_'+value.title+'_'+value.author;
			return false;
		}
	})

})
</script>

</body>
</html>
